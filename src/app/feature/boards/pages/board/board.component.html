<nav class="text-sm mb-4">
  <a routerLink="/projects" class="underline">Projects</a>
  <span class="opacity-60"> / </span>
  <a class="underline" (click)="backToProject()">
    {{ projectsStore.selected()?.name || 'Project' }}
  </a>
  <span class="opacity-60"> / </span>
  <span>Board</span>
</nav>

@if (boardStore.columns().length === 0) {
  <p class="opacity-70">No columns yet.</p>
} @else {
  <div class="flex gap-4 items-start overflow-x-auto">
    @for (col of boardStore.columns(); track col.id) {
      <div class="bg-base-200 rounded-box p-3 min-w-[260px]">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold text-sm">{{ col.name }}</h2>
          <button
            type="button"
            class="btn btn-xs btn-primary"
            (click)="openCreateCardModal(col.id)"
          >
            +
          </button>
        </div>

        <div class="space-y-2">
          @for (
            card of boardStore.cardsByColumn()[col.id] ?? []; track card.id) {
            <article class="card bg-base-100 shadow-sm">
              <div class="card-body p-3">
                <div class="flex justify-between items-start gap-2">
                  <h3 class="font-medium text-sm">
                    {{ card.title }}
                  </h3>

                  <div class="flex gap-1">
                    <button
                      type="button"
                      class="btn btn-xs"
                      (click)="openEditCardModal(card)"
                    >
                      Edit
                    </button>
                    <button
                      type="button"
                      class="btn btn-xs btn-error"
                      (click)="openDeleteCardDialog(card.id)"
                    >
                      âœ•
                    </button>
                  </div>
                </div>

                @if (card.description) {
                  <p class="text-xs opacity-80 mt-1">
                    {{ card.description }}
                  </p>
                }
              </div>
            </article>
          }
        </div>
      </div>
    }
  </div>
}

@if (isCardModalOpen()) {
  <div class="modal modal-open">
    <div class="modal-box">
      <h3 class="font-bold text-lg mb-4">
        {{ cardModalTitle() }}
      </h3>

      <form [formGroup]="cardForm" (ngSubmit)="submitCardForm()"
            class="space-y-4">
        <div class="form-control">
          <label class="label">
            <span class="label-text">Title</span>
          </label>
          <input
            type="text"
            class="input input-bordered w-full"
            formControlName="title"
            [class.input-error]="cardForm.controls.title.invalid && cardForm.controls.title.touched"
          />
          @if (cardForm.controls.title.invalid && cardForm.controls.title.touched) {
            <p class="text-xs text-error mt-1">Title is required</p>
          }
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text">Description</span>
          </label>
          <textarea
            class="textarea textarea-bordered w-full"
            rows="3"
            formControlName="description"
          ></textarea>
        </div>

        <div class="modal-action">
          <button type="button" class="btn btn-ghost"
                  (click)="closeCardModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary"
                  [disabled]="cardForm.invalid">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
}

<app-confirm-dialog
  [open]="isDeleteCardDialogOpen()"
  title="Delete card"
  message="Are you sure you want to delete this card?"
  confirmLabel="Delete"
  cancelLabel="Cancel"
  [destructive]="true"
  (confirmed)="confirmDeleteCard()"
  (cancelled)="cancelDeleteCard()"
></app-confirm-dialog>
